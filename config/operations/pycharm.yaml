# PyCharm IDE 操作配置

ide: pycharm
version: ">=2023.2"

operations:
  # 文件操作
  - name: double_click_file
    aliases: [双击文件, double click file, 双击]
    intent: file_operation
    description: 双击指定关键字所在的 UI 元素（文件树节点、按钮等）

    visual_prompt: |
      在截图中精确定位包含文本 "{filename}" 的 UI 元素。

      坐标系统说明：
      - 截图左上角为 (0, 0)
      - x 轴向右递增，y 轴向下递增
      - bbox 格式为 [x1, y1, x2, y2]，其中 (x1,y1) 是左上角，(x2,y2) 是右下角

      定位要求：
      1. 仔细查找包含精确文本 "{filename}" 的元素
      2. 该元素可能在：文件树、标签页、按钮、列表等位置
      3. 边界框必须紧密包裹该元素的实际可见区域
      4. 请多次确认坐标的准确性

      返回格式：
      - element_type: 元素类型
      - description: 元素描述（禁止使用双引号，文本用单引号）
      - bbox: 精确的边界框坐标 [x1, y1, x2, y2]
      - confidence: 定位置信度（0-1）

    actions:
      - type: double_click
        target: "0"  # 使用视觉定位返回的第一个元素（目标元素）
        timeout: 1.0

    requires_confirmation: false

  - name: open_file
    aliases: [打开文件, open file, 打开]
    intent: file_operation
    description: 在 PyCharm 中打开指定文件

    visual_prompt: |
      在截图中找到以下元素：
      1. 项目工具窗口中的文件树
      2. 目标文件：{filename}

    actions:
      - type: shortcut
        keys: ["ctrl", "shift", "a"]
        timeout: 1.0

      - type: type
        text: "Open File"
        delay: 0.1

      - type: shortcut
        keys: ["enter"]
        timeout: 1.0

      - type: type
        text: "{filename}"
        delay: 0.1

      - type: shortcut
        keys: ["enter"]
        timeout: 1.0

    post_check:
      type: verify_file_opened
      filename: "{filename}"

  - name: save_file
    aliases: [保存文件, save file, 保存]
    intent: file_operation
    description: 保存当前文件

    visual_prompt: |
      在截图中找到当前编辑器窗口

    actions:
      - type: shortcut
        keys: ["ctrl", "s"]
        timeout: 1.0

  - name: close_file
    aliases: [关闭文件, close file, 关闭]
    intent: file_operation
    description: 关闭当前文件

    visual_prompt: |
      在截图中找到当前编辑器窗口

    actions:
      - type: shortcut
        keys: ["ctrl", "f4"]
        timeout: 1.0

  - name: new_file
    aliases: [新建文件, new file, 新建]
    intent: file_operation
    description: 创建新文件

    actions:
      - type: shortcut
        keys: ["alt", "f"]
        timeout: 1.0

      - type: wait_for_dialog
        dialog_title: "New"

      - type: type
        text: "{filename}"
        delay: 0.1

      - type: shortcut
        keys: ["enter"]
        timeout: 1.0

  # 导航操作
  - name: go_to_line
    aliases: [跳转到行, go to line, 跳转]
    intent: navigation
    description: 跳转到指定行

    visual_prompt: |
      在截图中找到当前编辑器窗口

    actions:
      - type: shortcut
        keys: ["ctrl", "g"]
        timeout: 1.0

      - type: wait_for_dialog
        dialog_title: "Go to Line"

      - type: type
        text: "{line_number}"
        delay: 0.1

      - type: shortcut
        keys: ["enter"]
        timeout: 1.0

  - name: find_file
    aliases: [查找文件, find file, 搜索文件]
    intent: navigation
    description: 在项目中查找文件

    actions:
      - type: shortcut
        keys: ["ctrl", "shift", "n"]
        timeout: 1.0

      - type: wait_for_dialog
        dialog_title: "Navigate to File"

      - type: type
        text: "{filename}"
        delay: 0.1

      - type: shortcut
        keys: ["enter"]
        timeout: 1.0

  # 重构操作
  - name: rename_symbol
    aliases: [重命名, rename, refactor_rename]
    intent: refactor
    description: 重命名当前光标位置的符号

    visual_prompt: |
      在截图中找到：
      1. 当前编辑器中光标位置
      2. 确认光标在符号上

    actions:
      - type: shortcut
        keys: ["shift", "f6"]
        timeout: 1.0

      - type: wait_for_dialog
        dialog_title: "Rename"

      - type: type
        text: "{new_name}"
        delay: 0.1

      - type: shortcut
        keys: ["enter"]
        timeout: 1.0

    requires_confirmation: true
    risk_level: medium

  - name: format_code
    aliases: [格式化, format code, 格式化代码]
    intent: refactor
    description: 格式化当前文件代码

    actions:
      - type: shortcut
        keys: ["ctrl", "alt", "l"]
        timeout: 2.0

  - name: extract_method
    aliases: [提取方法, extract method]
    intent: refactor
    description: 提取选中的代码为方法

    actions:
      - type: shortcut
        keys: ["ctrl", "alt", "m"]
        timeout: 1.0

    requires_confirmation: true
    risk_level: medium

  # 运行操作
  - name: run_current_file
    aliases: [运行当前文件, run, 运行]
    intent: run
    description: 运行当前文件

    actions:
      - type: shortcut
        keys: ["ctrl", "shift", "f10"]
        timeout: 2.0

  - name: debug_current_file
    aliases: [调试, debug, 调试当前文件]
    intent: run
    description: 调试当前文件

    actions:
      - type: shortcut
        keys: ["shift", "f9"]
        timeout: 2.0

  - name: stop_run
    aliases: [停止运行, stop, 停止]
    intent: run
    description: 停止当前运行

    actions:
      - type: shortcut
        keys: ["ctrl", "f2"]
        timeout: 1.0

  # 编辑操作
  - name: copy_line
    aliases: [复制行, copy line]
    intent: edit
    description: 复制当前行

    actions:
      - type: shortcut
        keys: ["ctrl", "d"]
        timeout: 0.5

  - name: delete_line
    aliases: [删除行, delete line]
    intent: edit
    description: 删除当前行

    actions:
      - type: shortcut
        keys: ["ctrl", "y"]
        timeout: 0.5

  - name: undo
    aliases: [撤销, undo]
    intent: edit
    description: 撤销上一步操作

    actions:
      - type: shortcut
        keys: ["ctrl", "z"]
        timeout: 0.5

  - name: redo
    aliases: [重做, redo]
    intent: edit
    description: 重做操作

    actions:
      - type: shortcut
        keys: ["ctrl", "shift", "z"]
        timeout: 0.5

  # 搜索操作
  - name: find_in_file
    aliases: [在文件中查找, find, 查找]
    intent: search
    description: 在当前文件中查找文本

    actions:
      - type: shortcut
        keys: ["ctrl", "f"]
        timeout: 1.0

      - type: type
        text: "{search_text}"
        delay: 0.1

  - name: find_in_project
    aliases: [在项目中查找, find in project, 全局搜索]
    intent: search
    description: 在整个项目中查找

    actions:
      - type: shortcut
        keys: ["ctrl", "shift", "f"]
        timeout: 1.0

      - type: type
        text: "{search_text}"
        delay: 0.1

  # 其他操作
  - name: toggle_comment
    aliases: [切换注释, toggle comment, 注释]
    intent: edit
    description: 注释/取消注释当前行

    actions:
      - type: shortcut
        keys: ["ctrl", "/"]
        timeout: 0.5

  - name: optimize_imports
    aliases: [优化导入, optimize imports]
    intent: refactor
    description: 优化和删除未使用的导入

    actions:
      - type: shortcut
        keys: ["ctrl", "alt", "o"]
        timeout: 2.0

  # 输入操作
  - name: input_text
    aliases: [输入, 输入文本, 在输入框中输入]
    intent: input
    description: 在指定输入框中输入文本

    visual_prompt: |
      在截图中精确定位输入框：
      1. 查找包含文本 "{context_text}" 的元素
      2. 在该元素的 {position_hint} 找到输入框
      3. 如果没有指定位置提示，直接查找与描述匹配的输入框
      4. 输入框应具有明显的输入区域特征（空白区域、光标等）

      定位要求：
      - 仔细查找包含精确文本 "{context_text}" 的参考元素
      - 根据位置关系（{position_hint}）在其附近查找输入框
      - 边界框必须紧密包裹该输入框的实际可见区域
      - 请多次确认坐标的准确性

      返回格式：
      - element_type: text_field（输入框类型）
      - description: 元素描述（禁止使用双引号）
      - bbox: 精确的边界框坐标 [x1, y1, x2, y2]
      - confidence: 定位置信度（0-1）

    actions:
      - type: click
        target: "0"  # 使用视觉定位返回的第一个元素（目标输入框）
        timeout: 0.5

      - type: type
        text: "{input_text}"
        delay: 0.1

      # 仅当指定了 submit_action 为 enter 时才执行
      - type: shortcut
        keys: ["enter"]
        timeout: 0.5
        parameters:
          conditional: true
          conditional_param: submit_action  # 检查此参数是否存在

    requires_confirmation: false

  # 模板匹配操作示例
  - name: click_run_button
    aliases: [点击运行按钮, run button]
    intent: template_match
    description: 点击运行按钮（使用模板匹配）

    # 模板匹配参数
    template: run_button.png  # 模板图片文件名（相对于 template_dir）
    confidence: 0.8  # 匹配置信度阈值（可选，默认使用配置文件中的值）

    actions:
      - type: click
        target: "0"  # 使用模板匹配返回的第一个元素
        timeout: 1.0

    requires_confirmation: false

  - name: click_database_button
    aliases: [点击数据库按钮, database button]
    intent: template_match
    description: 点击数据库按钮（使用模板匹配）

    # 模板匹配参数
    template: database-button.png  # 模板图片文件名（相对于 template_dir）
    confidence: 0.8

    actions:
      - type: click
        target: "0"
        timeout: 1.0

    requires_confirmation: false

  - name: click_button
    aliases: [点击按钮, click button]
    intent: template_match
    description: 点击按钮（使用模板匹配，通过 --template 参数指定模板）

    # 模板匹配参数（通过命令行 --template 指定）
    template: null
    confidence: 0.8

    actions:
      - type: click
        target: "0"
        timeout: 1.0

    requires_confirmation: false

  # 窗口管理操作
  - name: activate_window
    aliases: [激活窗口, 切换到 PyCharm, activate window, 切换到, switch to, 切换, 激活, 打开]
    intent: window_management
    description: 将指定窗口置于前台（支持窗口标题或进程名，如 WeChatApp.exe）

    actions: []  # 窗口管理操作不需要 UI 动作

    requires_confirmation: false

  # 浏览器操作
  - name: open_browser
    aliases: [打开浏览器, 访问网址, 在浏览器中打开, 浏览器打开, open browser, 访问, 打开网址]
    intent: browser_launch
    description: 打开浏览器并访问指定网址

    actions: []  # 浏览器操作不需要 UI 动作

    requires_confirmation: false

  # 浏览器自动化操作
  # 使用这些命令时，请确保在命令中包含"网页"、"浏览器"或"页面"关键词
  # 例如："网页点击 百度一下按钮" 或 "页面滚动"
  - name: browser_click
    aliases: [网页点击, 浏览器点击, 点击网页, 页面点击, browser click, 网页上点击, 点击页面元素]
    intent: browser_automation
    description: 在浏览器中点击指定元素（使用 CSS 选择器或文本）

    actions: []

    requires_confirmation: false

  - name: browser_scroll
    aliases: [网页滚动, 滚动网页, 浏览器滚动, 页面滚动, scroll page, 滚动页面, 向下滚动网页, 向上滚动网页]
    intent: browser_automation
    description: 在浏览器中滚动页面

    actions: []

    requires_confirmation: false

  - name: browser_type
    aliases: [在网页输入, 浏览器输入, 网页输入, 页面输入, browser type, 在页面输入, 网页上输入]
    intent: browser_automation
    description: 在浏览器输入框中输入文本

    actions: []

    requires_confirmation: false

  - name: browser_wait
    aliases: [等待网页元素, 等待页面元素, browser wait, 等待页面加载, 页面等待加载]
    intent: browser_automation
    description: 等待浏览器中的元素出现

    actions: []

    requires_confirmation: false

  # 工作流操作
  - name: execute_workflow
    aliases: [执行工作流, 运行工作流, 运行步骤, 执行脚本, 工作流, workflow, execute workflow, run workflow]
    intent: workflow
    description: 执行工作流文件（Markdown 格式）

    # 工作流参数
    # workflow_file: 工作流文件路径（必需）
    # dry_run: 是否仅验证不执行（可选，默认 false）

    actions: []  # 工作流操作由 IDEController 内部处理

    requires_confirmation: false

  - name: validate_workflow
    aliases: [验证工作流, 验证步骤, validate workflow, check workflow]
    intent: workflow
    description: 验证工作流文件格式是否正确

    # 工作流验证参数
    # workflow_file: 工作流文件路径（必需）

    actions: []  # 工作流验证由 IDEController 内部处理

    requires_confirmation: false
